schema_version: 1
template:
  name: "tf-aws-ec2-base"
  engine: "terraform"
  version: "0.1.0.a2"
requirements:
  - name: "terraform"
  - name: "awscli"
  - name: "jq"
values:
  - name: "open_url"
    source: "output"
    source-key: "jupyter_url"
  - name: "aws_region"
    source: "output"
    source-key: "region"
commands:
  - cmd: "server.status"
    sequence:
      - api-name: "aws.ssm.wait-command-sync"
        arguments:
          - api-attribute: "document_name"
            source: "output"
            source-key: "server_status_check_document"
          - api-attribute: "instance_id"
            source: "output"
            source-key: "instance_id"
    results:
      - result-name: "jupyter_server_status"
        source: "result"
        source-key: "[0].StandardOutputContent"
  - cmd: "users.add"
    sequence:
      - api-name: "aws.ssm.wait-command-sync"
        arguments:
          - api-attribute: "document_name"
            source: "output"
            source-key: "auth_users_update_document"
          - api-attribute: "instance_id"
            source: "output"
            source-key: "instance_id"
          - api-attribute: "users"
            source: "cli"
            source-key: "users"
          - api-attribute: "action"
            source: "cli"
            source-key: "action"
  - cmd: "users.remove"
    sequence:
      - api-name: "aws.ssm.wait-command-sync"
        arguments:
          - api-attribute: "document_name"
            source: "output"
            source-key: "auth_users_update_document"
          - api-attribute: "instance_id"
            source: "output"
            source-key: "instance_id"
          - api-attribute: "users"
            source: "cli"
            source-key: "users"
          - api-attribute: "action"
            source: "cli"
            source-key: "action"
  - cmd: "teams.add"
    sequence:
      - api-name: "aws.ssm.wait-command-sync"
        arguments:
          - api-attribute: "document_name"
            source: "output"
            source-key: "auth_teams_update_document"
          - api-attribute: "instance_id"
            source: "output"
            source-key: "instance_id"
          - api-attribute: "teams"
            source: "cli"
            source-key: "teams"
          - api-attribute: "action"
            source: "cli"
            source-key: "action"
  - cmd: "teams.remove"
    sequence:
      - api-name: "aws.ssm.wait-command-sync"
        arguments:
          - api-attribute: "document_name"
            source: "output"
            source-key: "auth_teams_update_document"
          - api-attribute: "instance_id"
            source: "output"
            source-key: "instance_id"
          - api-attribute: "teams"
            source: "cli"
            source-key: "teams"
          - api-attribute: "action"
            source: "cli"
            source-key: "action"
